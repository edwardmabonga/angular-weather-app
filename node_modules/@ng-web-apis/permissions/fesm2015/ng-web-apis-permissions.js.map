{"version":3,"file":"ng-web-apis-permissions.js","sources":["ng://@ng-web-apis/permissions/tokens/permissions.ts","ng://@ng-web-apis/permissions/tokens/permissions-support.ts","ng://@ng-web-apis/permissions/services/permissions.service.ts"],"sourcesContent":["import {inject, InjectionToken} from '@angular/core';\nimport {NAVIGATOR} from '@ng-web-apis/common';\n\nexport const PERMISSIONS = new InjectionToken<Permissions>(\n    'An abstraction over window.navigator.permissions object',\n    {\n        factory: () => inject(NAVIGATOR).permissions,\n    },\n);\n","import {inject, InjectionToken} from '@angular/core';\nimport {PERMISSIONS} from './permissions';\n\nexport const PERMISSIONS_SUPPORT = new InjectionToken<boolean>(\n    'Is Permissions API supported?',\n    {\n        factory: () => {\n            return !!inject(PERMISSIONS);\n        },\n    },\n);\n","import {Inject, Injectable} from '@angular/core';\nimport {from, fromEvent, Observable} from 'rxjs';\nimport {map, shareReplay, startWith, switchMap} from 'rxjs/operators';\nimport {PERMISSIONS} from '../tokens/permissions';\nimport {PERMISSIONS_SUPPORT} from '../tokens/permissions-support';\n\nexport type PermissionsQueryArgs = Parameters<typeof Permissions.prototype.query>[0];\n\n// @dynamic\n@Injectable({\n    providedIn: 'root',\n})\nexport class PermissionsService {\n    constructor(\n        @Inject(PERMISSIONS) private readonly permissions: Permissions,\n        @Inject(PERMISSIONS_SUPPORT) private permissionsSupported: boolean,\n    ) {}\n\n    state(name: PermissionName): Observable<PermissionState>;\n    state(descriptor: PermissionsQueryArgs): Observable<PermissionState>;\n    state(\n        nameOrDescriptor: PermissionName | PermissionsQueryArgs,\n    ): Observable<PermissionState> {\n        const descriptor: PermissionDescriptor =\n            typeof nameOrDescriptor === 'string'\n                ? {name: nameOrDescriptor}\n                : nameOrDescriptor;\n\n        return new Observable<PermissionState>(subscriber => {\n            if (!this.permissionsSupported) {\n                subscriber.error('Permissions is not supported in your browser');\n\n                return;\n            }\n\n            return from(this.permissions.query(descriptor))\n                .pipe(\n                    switchMap(status =>\n                        fromEvent(status, 'change').pipe(\n                            startWith(null),\n                            map(() => status.state),\n                        ),\n                    ),\n                )\n                .subscribe(subscriber);\n        }).pipe(shareReplay({bufferSize: 1, refCount: true}));\n    }\n}\n"],"names":[],"mappings":";;;;;;;;;;;MAGa,WAAW,GAAG,IAAI,cAAc,CACzC,yDAAyD,EACzD;IACI,OAAO;;;IAAE,MAAM,MAAM,CAAC,SAAS,CAAC,CAAC,WAAW,CAAA;CAC/C;;;;;;;;MCJQ,mBAAmB,GAAG,IAAI,cAAc,CACjD,+BAA+B,EAC/B;IACI,OAAO;;;IAAE;QACL,OAAO,CAAC,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC;KAChC,CAAA;CACJ;;;;;;;;MCGQ,kBAAkB;;;;;IAC3B,YAC0C,WAAwB,EACzB,oBAA6B;QAD5B,gBAAW,GAAX,WAAW,CAAa;QACzB,yBAAoB,GAApB,oBAAoB,CAAS;KAClE;;;;;IAIJ,KAAK,CACD,gBAAuD;;cAEjD,UAAU,GACZ,OAAO,gBAAgB,KAAK,QAAQ;cAC9B,EAAC,IAAI,EAAE,gBAAgB,EAAC;cACxB,gBAAgB;QAE1B,OAAO,IAAI,UAAU;;;;QAAkB,UAAU;YAC7C,IAAI,CAAC,IAAI,CAAC,oBAAoB,EAAE;gBAC5B,UAAU,CAAC,KAAK,CAAC,8CAA8C,CAAC,CAAC;gBAEjE,OAAO;aACV;YAED,OAAO,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;iBAC1C,IAAI,CACD,SAAS;;;;YAAC,MAAM,IACZ,SAAS,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC,IAAI,CAC5B,SAAS,CAAC,IAAI,CAAC,EACf,GAAG;;;YAAC,MAAM,MAAM,CAAC,KAAK,EAAC,CAC1B,EACJ,CACJ;iBACA,SAAS,CAAC,UAAU,CAAC,CAAC;SAC9B,EAAC,CAAC,IAAI,CAAC,WAAW,CAAC,EAAC,UAAU,EAAE,CAAC,EAAE,QAAQ,EAAE,IAAI,EAAC,CAAC,CAAC,CAAC;KACzD;;;YArCJ,UAAU,SAAC;gBACR,UAAU,EAAE,MAAM;aACrB;;;;YAG0D,WAAW,uBAA7D,MAAM,SAAC,WAAW;0CAClB,MAAM,SAAC,mBAAmB;;;;;;;;IAD3B,yCAA8D;;;;;IAC9D,kDAAkE;;;;;;;;;;;;;;;;;"}